<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="keywords" content="d3js, networkGraph">
    <script type="text/javascript" src="https://www.khan.co.kr/spko/js/plugin/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"></script>
    <style>
        #NETWORK_GRAPH .node-label
        { font-size: 14px;
            font-weight:bold; color:#111;
            stroke: white;stroke-width: 1.5px;
            paint-order: stroke fill;
            text-anchor: middle;}
    </style>
    <title>Title</title>
</head>
<body>
<div class="netwrok-graph-holder">
    <div class="network-graph">
        <svg id="NETWORK_GRAPH">
        <!--그래프 그려짐-->
    </svg>
    </div>

    <script type="text/javascript" src="wordData.js">//단어 데이터</script>

    <script>
        /********network graph********/
        var networkGraph = {
            createGraph : function(){
                var links = NETWORK_DATA.links.map(function(d){
                    return Object.create(d)
                });
                var nodes = NETWORK_DATA.nodes.map(function(d){
                    return Object.create(d)
                });
                var color = function(d){
                    var scale = d3.scaleOrdinal(d3.schemeCategory10);
                    return (scale(d.group));
                };

                //부정: 붉은색, 중립: 파란색, 긍정: 녹색, 키워드: 그룹에 미포함+보라색+value 10
                var fillCircle = function(g){
                    if(g == "neg"){
                        return "#ff3c00";
                    }else if(g=="neut"){
                        return "#386cff";
                    }else if(g=="pos"){
                        return "#6fbc5b";
                    }else{
                        return "#c67cff";
                    }
                };


                //화면 사이즈: 500*500

                var width = 500;
                var height = 500;

                //네트워크형 그래프 중력과 장력 조절

                var simulation = d3.forceSimulation(nodes)
                    .force("link", d3.forceLink(links).id( function(d){ return d.id }))
                    .force("charge", d3.forceManyBody().strength(-20))
                    .force("center", d3.forceCenter(width / 2, height / 2))
                    .force("collide",d3.forceCollide().radius( function(d){ return d.value*8}) );


                //d3에서 제공하는 네트워크 그래프 이용, 노드와 라인 추가
                var svg = d3.select("#NETWORK_GRAPH")
                    .attr("viewBox", [0, 0, width, height]);
                var gHolder = svg.append("g")
                    .attr("class", "g-holder");
                var link = gHolder.append("g")
                    .attr("stroke", "#999")
                    .attr("stroke-opacity", 0.6)
                    .selectAll("line")
                    .data(links)
                    .join("line")
                    .attr("stroke-width", function(d){ return Math.sqrt(d.value*5)} );



                var node = gHolder.append("g")
                    .attr("class", "circle-node-holder")
                    .selectAll("g")
                    .data(nodes)
                    .enter()
                    .append("g")
                    .each(function(d){
                        d3.select(this)
                            .append("circle")
                            .attr("r", d.value*5)
                            .attr("fill", fillCircle(d.group));
                        d3.select(this)
                            .append("text").text(d.id)
                            .attr("dy",6)
                            .style("text-anchor","middle")
                            .attr("class", "node-label")
                    })//.call(networkGraph.drag(simulation)); -드래그 효과 안쓰기 때문에 콜 함수 주석처리함

                //노드 좌표 설정

                simulation.on("tick", function(){
                    link.attr("x1", function(d){ return d.source.x; })
                        .attr("y1", function(d){ return d.source.y; })
                        .attr("x2", function(d){ return d.target.x; })
                        .attr("y2", function(d){ return d.target.y; });


                    //circle 노드에서 g 노드로 변경
                    node.attr("transform", function(d) { return "translate("+d.x+","+ d.y+")"; });
                });



                return svg.node();
            },


            drag : function(simulation){
                function dragstarted(d) {
                    if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                }

                function dragged(d) {
                    d.fx = d3.event.x;
                    d.fy = d3.event.y;
                }

                function dragended(d) {
                    if (!d3.event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                }

                return d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended);
            }
        }
        //드래그 이벤트인데... 이걸 주석처리하면 하단의 네트워크 그래프 생성 함수가 콜이 안됨... 왜지?

        /********network graph********/
        networkGraph.createGraph();

    </script>
</div>
</body>
</html>